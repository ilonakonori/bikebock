<div class="my-card">
  <div class="my-row" style="display: flex; justify-content: space-around; padding: 16px 0;">
     <%= cl_image_tag @user.profile_photo.key, height: 147, width: 147, crop: :fill, style: "border-radius: 50%; box-shadow: 3px 4px 5px 0px rgba(0, 0, 0, 0.38);" %>
      <div class="my-card-body" style="padding: 0 16px;">

        <h6 style="font-size: 4vw;"><%= @user.name %>
          <!--build here dot-->
          <span id='last-online' data-online-id="<%= @user.id %>" style="font-size: 4vw;"><%= @user.online? %>
          </span>
        </h6>

          <hr style="width: 95%; text-align: left; margin-left: 0;">
        <p style="font-size: 3vw;"><%= @user.about_me %></p>
      </div>
    </div>
</div>

<div class="card" style="box-shadow: inset 0 0 4vmin 3vmin rgba(0,0,0,0.5);">
  <%= cl_image_tag @user.bike_photo.key, class: "d-block w-100", style: "border-radius: 16px; height: 50vw;"%>
</div>

<div class="my-container" style="padding: 24px 0;">
  <div style="display: flex; flex-wrap: wrap;">
    <% @user.interests.split(/\W+/).each do |i| %>
      <p class="interests"><%= i.upcase %></p>
    <% end %>
  </div>
</div>

<div>
  <% if @user.rides.empty? %>
    <p class="text-secondary"> You still don't have any bike rides</p>
  <% else %>
    <% @user.rides.each do |ride| %>
      <%= link_to ride_path(ride) do %>
        <div class="card" style="padding: 8px; background-color: #FDE8CD; color: #000; border-radius: 16px; border: 0px;">
        <div style="display: flex; justify-content: flex-end; align-items: center; padding: 8px 8px;">
          <%= cl_image_tag @user.profile_photo.key, height: 30, width: 30, crop: :fill, style: "border-radius: 50%; box-shadow: 3px 4px 5px 0px rgba(0, 0, 0, 0.38);" %>
        </div>
          <%= cl_image_tag ride.photos.second.key, style: "border-radius: 16px; height: 40vw;"%>
        <br>
          <div style="display: flex; justify-content: start;">
            <h5 style="font-size: 4vw; padding-left: 4px; padding-right: 4px; color: #333333;"><%= ride.title %></h5>
            <p style="display: flex; justify-content: flex-end; color: #00917C; padding-right: 0; font-size: 12px;">
            <!-- fake ratings atm -->
            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></p>
          </div>
          <p style="font-size: 3vw; padding-left: 4px;"><%= ride.short_description[0..200] %>...</p>
        </div>
      <% end %>
    <% end %>
  <% end %>
  <br>
  <br>
  <div>
    <% if @user == current_user %>

      <hr style="width: 100%; text-align: left; margin-left: 0;"/>
      <!-- sidebar! -->
      <%= link_to "My Messages", conversations_path %>
      <hr style="width: 100%; text-align: left; margin-left: 0;"/>
      <%= link_to "Add Ride", new_ride_path, class: "" %>
      <hr style="width: 100%; text-align: left; margin-left: 0;"/>
      <%= link_to "Edit Profile", edit_user_registration_path(@user) %>
      <!-- end -->

    <% elsif Request.where(accepted: false, sender_id: current_user, recipient_id: @user).present? %>
      <% request = Request.where(accepted: false, sender_id: current_user, recipient_id: @user).first %>
      <%= link_to 'Request already sent, status: pending', request_path(request.id) %>
    <% elsif Request.where(accepted: false, sender_id: @user, recipient_id: current_user).present? %>
      <% request = Request.where(accepted: false, sender_id: @user, recipient_id: current_user).first %>
      <%= link_to 'Check your request', request_path(request.id) %>
    <% elsif Conversation.where(sender_id: current_user, recipient_id: @user).present? || Conversation.where(sender_id: @user, recipient_id: current_user).present? %>
      <% room = Conversation.where(sender_id: current_user, recipient_id: @user).or(Conversation.where(sender_id: @user, recipient_id: current_user)).first %>
      <%= link_to 'Chat', conversation_path(room.id, anchor: "message-#{room.messages.last.id}")%>
    <% else %>
      <%= link_to "Send Message Request", new_request_path(sender_id: current_user, recipient_id: @user) %>
    <% end %>
  </div>
</div>

<script>
//make js file + make it for chat
function updatePresence() {
  const user = document.getElementById('last-online');
  const id = user.dataset.onlineId;

  setInterval(function() {

     $.ajax({
    url:  `/users/${id}/presence`,
    type: 'GET'
    })
    .done(function(response){
      //console.log(response);
    })
    //console.log(`${id} sent`);
  }, 5000);
}
window.onload = updatePresence();
</script>

