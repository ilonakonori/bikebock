<!-- carousel -->
<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <div class="carousel-inner" style='border-radius: 16px; height: 37vw; box-shadow: 3px 4px 5px 0px rgba(0, 0, 0, 0.38);'>
    <% ride.photos.each_with_index do |photo, i| %>
      <div class="carousel-item <%= 'active' if i == 0 %>">
        <%= cl_image_tag photo.key, class: "d-block w-100" %>
      </div>
    <% end %>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
<br>
<!-- ride details -->
<div class="card card-ride">
 <h5 style="font-size: 4vw; padding-left: 4px; padding-right: 4px; color: #333333;"><%= ride.title %></h5>
  <p style="font-size: 3vw; padding-left: 4px; color: #333333;"><%= ride.short_description %></p>
  <!-- location -->
  <div class='box'>
    <div class='line' style='top: 40%;'></div>
    <div class='row'>
      <div style='max-width: 45%; z-index: 2; display: flex; vertical-align: middle; padding-left: 4px;'>
        <p style="z-index: 2; border-style: solid; border-width: 0; border-radius: 16px; font-size: 3vw; padding: 1vh 2vh; color: white; background-color: #00917C; font-weight: bolder; box-shadow: 0px 4px 4px rgba(8, 13, 60, 0.09);">
          <%= ride.start_location %>
        </p>
      </div>
      <div style='max-width: 45%; z-index: 2; display: flex; vertical-align: middle; padding-right: 4px;'>
        <p style="z-index: 2; border-style: solid; border-width: 0; border-radius: 16px; font-size: 3vw; padding: 1vh 2vh; color: white; background-color: #00917C; font-weight: bolder; box-shadow: 0px 4px 4px rgba(8, 13, 60, 0.09);">
          <%= ride.end_location %>
        </p>
      </div>
    </div>
  </div>
  <!-- time box -->
  <div class='box'>
    <div class='line' style='top: 40%;'></div>
    <div class='row'>
      <p style="z-index: 2; border-style: solid; border-width: 0; border-radius: 16px; font-size: 3vw; padding: 1vh 3vh; margin-left: 4px; color: white; background-color: #00917C; font-weight: bolder; box-shadow: 0px 4px 4px rgba(8, 13, 60, 0.09);">
        <%= ride.start_time.strftime("%H:%M") %></p>
      <p style="z-index: 2; border-style: solid; border-width: 0; border-radius: 16px; font-size: 2vw; padding: 1vh 3vh; margin-right: 4px; color: white; background-color: #00917C; font-weight: bolder; box-shadow: 0px 4px 4px rgba(8, 13, 60, 0.09);">
        <%= ride.end_time.strftime("%H:%M") %>
      </p>
    </div>
  </div>
  <!-- difficulty -->
  <p style='margin: 0; padding: 0; font-size: 12px; padding-left: 4px; font-weight: 600;'>Difficulty: <%#= ride.difficulty %></p>
  <div class='box'>
    <div class='line' style="padding-left: 4px; padding-right: 4px;"></div>
    <div class='row' style="padding-left: 4px; padding-right: 4px;">
      <% ride.difficulty.to_i.times do |d| %>
        <div class='dot' style='background-color: #00917C'></div>
      <% end %>
      <% (5 - ride.difficulty.to_i).times do |d| %>
        <div class='dot'></div>
      <% end %>
    </div>
  </div>
  <!-- number of people -->
  <br>
  <p style='margin: 0; padding: 0; font-size: 12px; padding-left: 4px; font-weight: 600'>Number of people: </p>
  <div class='box'>
    <div class='line' ></div>
    <div class='row' style="padding-left: 4px; padding-right: 4px;">
       <% ride.number_of_people.to_i.times do |d| %>
        <div class='dot' style='background-color: #00917C'></div>
      <% end %>
      <% (5 - ride.number_of_people.to_i).times do |d| %>
        <div class='dot'></div>
      <% end %>
    </div>
  </div>
  <!-- available dates -->
  <p style='margin: 0; padding: 12px 0; font-size: 12px; padding-left: 4px; font-weight: 600;'>Dates:</p>
  <div class="my-container" style="padding: 0;">
    <div style="display: flex; flex-wrap: wrap;">
      <% ride.available_dates.split(', ').map { |el| el.to_date }.sort.each do |d| %>
        <p style="border-style: solid; border-width: 0; border-radius: 16px; font-size: 3vw; padding: 1vh 2vh; margin-left: 4px; color: white; background-color: #00917C; font-weight: bolder; box-shadow: 0px 4px 4px rgba(8, 13, 60, 0.09);">
          <%= d.strftime('%e %B %Y') %>
        </p>
      <% end %>
    </div>
  </div>
  <br>
  <!-- btns -->
  <div class='btn-box' style='display: flex; justify-content: center;'>
    <% if policy(ride).edit? %>
      <%= link_to 'Edit', edit_ride_path(ride) %>
    <% end %>
    <% if policy(ride).destroy? %>
      <%= link_to "Delete", ride, method: :delete, data: {confirm: "Are you sure?"} %>
    <% end %>


     <!-- wip -->
    <% if Request.where(accepted: false, user_id: current_user, ride_id: ride.id).present? %>
      <% requests = Request.where(accepted: false, user_id: current_user, recipient_id: ride.user_id) %>

      <% requests.each do |r| %>
        <p>Request for <%= r.ride_date %> sent, status: pending'</p>
      <% end %>

      <% all_dates = requests.map { |r| r.ride_date }
         my_dates = (ride.available_dates.split(' ') + all_dates)
         av_dates = my_dates.select { |d| my_dates.count(d) == 1 }
       %>

      <%if av_dates.present? %>
        <a onclick='showForm(this)'>Send more</a>
         <div id='myForm' style='display:none;'>
          <%= simple_form_for(@request) do |f| %>
            <%= f.input :ride_date, collection: av_dates, prompt: "Select date", selected: ride.available_dates.first %>
            <%= f.hidden_field :user_id, :value => current_user.id %>
            <%= f.hidden_field :recipient_id, :value => ride.user_id %>
            <%= f.hidden_field :ride_id, :value => ride.id %>
            <%= f.submit value="Send", class: "" %>
          <% end %>
        </div>
      <% end %>

    <% elsif current_user.id != ride.user_id %>
      <a onclick='showForm(this)'>I want to go</a>
      <!-- wip-->
      <div id='myForm' style='display:none;'>
        <%= simple_form_for(@request) do |f| %>
          <%= f.input :ride_date, collection: ride.available_dates.split(' '), prompt: "Select date", selected: ride.available_dates.first %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :recipient_id, :value => ride.user_id %>
          <%= f.hidden_field :ride_id, :value => ride.id %>
          <%= f.submit value="Send", class: "" %>
        <% end %>
      </div>
    <% end %>

  </div>
  <br>
</div>

<script>
  function showForm(_this) {
    document.getElementById('myForm').style.display = 'inherit';
    _this.style.display = 'none';
  }
</script>
